<% content_for :head do %>
  <%= render 'projects/yui_dependencies' %>
  <%= stylesheet_link_tag 'project' %>
  <%= stylesheet_link_tag 'user-list/user-regular' %>
<% end %>

<% if !signed_in? %>
  <p> Create an account </p>
<% end %>

<div class="container yui-skin-sam" id="project_new">
	<%= form_for(@project) do |f| %>
   	<%= render	'shared/error_messages', :object => f.object %>
    <div class="span-7" id="project_new_left">  
		  <div class="field">
        <%= f.label :name %>
			  <%= f.text_field :name %>
		  </div>
		
		  <div class="field">			
        <%= f.label :short_description %>		
       	<%= f.text_area :abstract, :rows=>2, :cols=>4  %>
		  </div>

		  <div class="field">
        <%= f.label :tags %>
			  <%= f.text_field :kind_list, :value => @tag_string %></br>
		  </div>
    
      <div class= "span-6 last" id="common_tags">
        <h3>Common tags include: </h3>
        <p>
        <% Project.kind_counts.first(10).each do |k| %>
          <%= k[:name] %>, 
        <% end %>
        </p>
      </div>
      
      <div class="span-7 last" id="include_collaborotars">
        <%= f.label :collaborators %><br />
        <%= autocomplete_field_tag 'collaborotors', '', autocomplete_user_name_projects_path, :size => 26, :id_element => '#cids' %>
      </div>
      <%= hidden_field_tag 'cids' %>
    </div>

    <div class="span-16 last" id="project_new_right">
      <div class="field">
          <%= f.label :project_description %><br />
			    <%= f.text_area :description, :rows=>5, :cols=>40 %>
	    </div>
	
      <div class="field">
          <%= f.label :add_project_picture %>
			    <%= f.file_field :photo %>
	    </div>
		<div class="field">
			<%= f.label "File to Upload" %><br />
			<%= f.file_field :mainfile %>
		</div>
		
		  <div class="submit">
			  <%= f.submit "Create Project" %><br />
		  </div>
    </div>
  <% end %>
	<%= render 'projects/yui_script', :editor => "project_description" %>
</div>
<%= javascript_tag do %>
  function monkeyPatchAutocomplete() {

      // don't really need this, but in case I did, I could store it and chain
      var oldFn = $.ui.autocomplete.prototype._renderItem;

      $.ui.autocomplete.prototype._renderItem = function( ul, item) {
          var re = new RegExp("^" + this.term, "i") ;
          var t = item.label.replace(re,"<span style='font-weight:bold;color:white;'>" + 
                  this.term + 
                  "</span>");
          var userpic = "<div class='user_pic'><img src=" + item.img + "></div>";
          var userinfo = "<div class='user_info'>" + item.info + "<br></div>";
          var userdiv = "<div class='user' style='width:208px; height:50px;'>" + userpic + t + userinfo + "</div>";
          return $( "<li></li>" )
              .data( "item.autocomplete", item )
              .append( "<a>" + userdiv + "</a>" )
              .appendTo( ul );
      };
  }
  monkeyPatchAutocomplete();
<% end %>


